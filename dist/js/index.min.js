const setValidation=()=>{document.querySelectorAll(".setvalidation").forEach((e,t)=>{e.addEventListener("input",(function(){return resetInputs(this),!1})),e.addEventListener("paste",(function(){return resetInputs(this),!1})),e.addEventListener("focus",(function(){return e.value&&e.classList.add("focus"),!1})),e.addEventListener("blur",(function(){return e.classList.remove("focus"),completeInput(e,validation(item)),!1}))})};function validation(e){let t=e.children[0].value,n=validLets[e.children[0].getAttribute("data-valid-id")],a={reg:!1,min:!1,max:!1,fun:!1,all:!1};n.reg.test(t)?a.reg=!0:a.reg=!1,n.min<=t.length?a.min=!0:a.min=!1,n.max>=t.length?a.max=!0:a.max=!1,void 0!==n.f()&&null!==n.f()?n.f()?a.fun=!0:a.fun=!1:a.fun=!0;for(let e in a)if(a.all=!0,!a[e]){a.all=!1;break}return a}function resetInputs(e){let t=validation(e),n=[];for(key in t)n.push(t[key]);for(let t=0;t<e.children[1].children.length;t++){e.children[1].children[t].classList.remove("valid-true","valid-false");let a="valid-"+n[t];e.children[1].children[t].classList.add(a)}completeInput(e,t)}function completeInput(e,t){e.classList.remove("valid-true","valid-false"),t.all?e.classList.add("valid-true"):e.classList.add("valid-false")}function isUnique(e){let t=document.querySelector(`input[name='inpr--${e}']`).value;if(t.length){let n={text:t,col:"u_"+e};return $.ajax({url:"server/user.php",method:"post",data:"isunique="+JSON.stringify(n),async:!1,success:function(e){res=e}}),res}}function register(){let e=document.querySelectorAll(".setvalidation"),t=!0;e.forEach(e=>{validation(e).all||(t=!1),completeInput(e,validation(e))});let n=new Date,a=new Date(document.querySelector("input[name='inpr--date']").value);if(Math.round((n-a)/864e5)<5110&&(t=!1),t){let t={name:e[0].children[0].value,email:e[1].children[0].value,login:e[2].children[0].value,pass:e[3].children[0].value,pass2:e[4].children[0].value,phone:e[5].children[0].value,date:e[6].children[0].value},n=JSON.stringify(t);$.ajax({url:"server/user.php",method:"post",data:"reg_info="+n,success:function(e){console.log(e),"00true"==e&&(document.location.href="profile.php")}})}}function login(){let e={login:document.querySelector("input[name='linp--login']").value,pass:document.querySelector("input[name='linp--pass']").value};if(e.login.length>0&&e.pass.length>0){let t=JSON.stringify(e);$.ajax({url:"server/user.php",method:"post",data:"log_info="+t,success:function(e){"0"!==e?(setTimeout(()=>{document.location.href="profile.php"},1e3),message({target:"message",type:"success",text:"Вы успешно авторизировались"})):message({target:"message",type:"error",text:"Неправильно указаны логин и/или пароль"})}})}else message({target:"message",type:"error",text:"Поле логин и/или пароля не заполнены"})}function logout(){this.addEventListener("click",(function(){$.ajax({url:"server/user.php",data:"logout=true",type:"POST",success:function(e){"true"==e&&(document.location.href="index.php")}})}))}function udpateUserInfo(){let e=document.querySelectorAll(".input-text"),t=document.querySelectorAll(".setvalidation"),n=!0;if(t.forEach(e=>{validation(e).all||(n=!1),completeInput(e,validation(e))}),n){uploadFile(document.querySelector("#edit--image"));let t=[];e.forEach(e=>{t.push(e.value)});let n=JSON.stringify(t);$.ajax({url:"server/user.php",method:"post",data:"edit="+n,success:function(e){"true"==e&&(document.location.href="profile.php")}})}}function uploadFile(e){let t=e;if(t.value){let e=new FormData;e.append("img",$(t).prop("files")[0]),$.ajax({url:"server/images.php",data:e,processData:!1,contentType:!1,type:"POST",success:function(e){"true"==e&&(document.location.href="profile.php")}})}}function itemUpload(e){let t=document.querySelector(".imgpreviews");function n(e){$.ajax({url:"server/itemsrc.php",data:e,processData:!1,contentType:!1,type:"POST",success:function(e){"false"!==e&&(t.innerHTML+=`<div class="img"><img src="${e}" alt=""><a class="del"></a></div>`,a())}})}function a(){document.querySelectorAll(".img .del").forEach(e=>{e.addEventListener("click",(function(){$.ajax({url:"server/itemsrc.php",data:"del="+e.previousSibling.getAttribute("src"),type:"POST",success:function(t){e.parentNode.classList.add("predel"),setTimeout(()=>{e.parentNode.remove()},500)}})}))})}e.addEventListener("change",(function(){if(t.children.length<10&&e.files.length<10&&e.value)for(let t=0;t<e.files.length;t++){let a=new FormData;a.append("img",$(e).prop("files")[t]),n(a)}})),document.querySelectorAll(".img .del")&&a()}function addNewItem(e){let t=new Date,n={name:document.querySelector('.inp input[name="item_name"]').value,text:document.querySelector('.inp textarea[name="item_text"]').value,images:"",cats:"",show_name:document.querySelector("#itemtab .checkbox input").checked,date:t.getFullYear()+"-"+(t.getMonth()<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-"+(t.getDate()<10?"0"+t.getDate():t.getDate())};document.querySelectorAll(".imgpreviews .img img").forEach(e=>{n.images+=e.getAttribute("src")+";"}),document.querySelectorAll(".inp.dls input").forEach(e=>{n.cats+=e.value.length>0?e.value+";":""});let a=!0;for(let e in n)0==n[e].length&&(a=!1);if(a&&"add"==e&&$.ajax({url:"server/itemsrc.php",data:"newpost="+JSON.stringify(n),type:"POST",success:function(e){console.log(e),"true"==e&&(message({target:"message",type:"success",text:"Заявление добавленно!"}),setTimeout(()=>{document.location.href="index.php"},1e3))}}),a&&"edit"==e){let e=window.location.search.split("=")[1];$.ajax({url:"server/itemsrc.php",data:"editpost="+JSON.stringify(n)+"&item="+e,type:"POST",success:function(t){"true"==t&&(message({target:"message",type:"success",text:"Данные обновленны"}),setTimeout(()=>{document.location.href="viewitem.php?id="+e},1e3))}})}}function clearInputs(){document.querySelectorAll(".inp .input-text").forEach(e=>{e.value=""}),document.querySelectorAll(".imgpreviews .img img").forEach(e=>{e.parentNode.classList.add("predel"),setTimeout(()=>{e.parentNode.remove()},500),$.ajax({url:"server/itemsrc.php",data:"del="+e.getAttribute("src"),type:"POST"})})}function disItem(){message({target:"message",type:"confirm",text:'Удалить заявку? Вышу заявку сможет восстановить только администратор<br><div class="buttons"><a class="btn btn--def confdel" onclick="del()">Удалить</a><a class="back" onclick="window.location.reload()">Отмена</a></div>'})}function del(){let e=window.location.search.split("=")[1];$.ajax({url:"server/itemsrc.php",data:"disabledpost="+e,type:"POST",success:function(e){console.log(e),"true"==e&&(message({target:"message",type:"success",text:"Заявка удаленна"}),setTimeout(()=>{document.location.href="profile.php"},1e3))}})}function editStatus(e){console.log("1123");let t=window.location.search.replace("?","").split("=")[1];$.ajax({url:"server/itemsrc.php",type:"POST",data:"status="+e.checked+"&itemid="+t,success:function(e){"true"==e&&window.location.reload()}})}function setNotify(){}function getNotify(){var e=new EventSource("server/notify.php");e.onopen=function(e){console.log("Открыто соединение")},e.onmessage=function(e){console.log("Сообщение: "+e.data)},e.onerror=function(e){this.readyState==EventSource.CONNECTING?console.log("Ошибка соединения, переподключение"):console.log("Состояние ошибки: "+this.readyState)}}function readNotify(){$.ajax({})}const dopPsevdoUi=()=>{const e=document.querySelectorAll(".inp");if(e.length>0){document.querySelectorAll(".inp .input-text").forEach((t,n)=>{t.addEventListener("focus",(function(){e[n].classList.add("focus")})),t.addEventListener("blur",(function(){e[n].classList.remove("focus")}))})}};let messageid=0;const message=e=>{messageid++,document.querySelector(".message__form").innerHTML+=`\n        <div class="popap ${e.target}" data-message-type="${e.type}" data--message-id="${messageid}" style="order: ${10-messageid};">\n            <div class="popap__inner">${e.text}</div>\n            <a class="btn--popap-close" data--close-id="${messageid}"></a>\n        </div>\n    `,setTimeout(()=>{document.querySelector(`.popap[data--message-id='${messageid}']`).classList.add("show")},50),document.querySelectorAll(".btn--popap-close").forEach(e=>{e.addEventListener("click",(function(){!function(e){let t=document.querySelector(`.popap[data--message-id='${e.getAttribute("data--close-id")}']`);t.classList.remove("show"),setTimeout(()=>{t.style="height: 0; margin: 0; padding: 0;"},400),setTimeout(()=>{let t=document.querySelector(`.popap[data--message-id='${e.getAttribute("data--close-id")}']`);t.parentNode.removeChild(t)},1e3)}(e)}))})},defaultSlider=e=>{const t=document.querySelector(e.target);let n;e.hasOwnProperty("controlls")?n=document.querySelectorAll(e.controlls):e.hasOwnProperty("thumbs")&&(n=document.querySelectorAll(e.thumbs));let a=0;n.forEach(n=>{n.addEventListener("click",(function(){n.classList.contains("left")&&console.log("123"),n.classList.contains("right")&&a!==t.children.length-2?a++:n.classList.contains("left")&&a>0?a--:a=n.getAttribute("data--slider-active"),function(e){for(let n=0;n<t.children.length;n++)t.children[n].style=`left: ${n*e}px; transform: translateX(${-e*a}px);`}(e.line)}))});for(let n=0;n<t.children.length;n++)t.children[n].style=`left: ${n*e.line}px;`};function searchall(){let e=document.querySelector("#searchall .inp input").value;document.querySelector("#searchall .inp a").setAttribute("href","allitems.php?search="+e)}function modal(e){document.querySelector(`.modal[data--modal="${e.getAttribute("data--toggle-modal")}"]`).classList.toggle("show")}document.addEventListener("DOMContentLoaded",(function(){dopPsevdoUi(),setValidation(),getNotify();let e=document.querySelector("#edit--image"),t=document.querySelectorAll(".nav .link"),n=document.querySelector("#additemimg");if(n&&itemUpload(n),e){let t=document.querySelector("#imgprev");e.addEventListener("change",(function(e){const[n]=this.files;n&&(t.src=URL.createObjectURL(n),t.classList.add("show"))}))}t.forEach(e=>{e.addEventListener("click",(function(){t.forEach(e=>{e.classList.remove("current")}),e.classList.add("current")})),e.classList.remove("current");let n=window.location.pathname.split("/");if(n[n.length-1]==e.getAttribute("href")&&e.classList.add("current"),null!=e.getAttribute("data--pathnames-current")){e.getAttribute("data--pathnames-current").split(";").forEach(t=>{n[n.length-1]==t&&e.classList.add("current")})}}),document.addEventListener("click",(function(e){let t=document.querySelectorAll(".modal.show");t.length>0&&(e.target.closest(".modal")||e.target.closest("a[data--toggle-modal]")||t.forEach(e=>{e.classList.remove("show")}))}))}));